<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VacaPanel - Gesti√≥n de Vacaciones</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&family=Space+Mono:wght@400;700&display=swap');
        
        :root {
            --primary: #2563eb;
            --primary-dark: #1e40af;
            --secondary: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --info: #8b5cf6;
            --bg: #f8fafc;
            --surface: #ffffff;
            --text: #1e293b;
            --text-muted: #64748b;
            --border: #e2e8f0;
            --festivo: #fca5a5;
            --aprobado: #86efac;
            --pendiente: #fde047;
            --dias-2025: #c084fc;
            --shadow: 0 1px 3px rgba(0,0,0,0.1), 0 1px 2px rgba(0,0,0,0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Outfit', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: var(--text);
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: var(--surface);
            border-radius: 20px;
            box-shadow: var(--shadow-lg);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 30px 40px;
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -10%;
            width: 300px;
            height: 300px;
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
            animation: float 6s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }
        
        h1 {
            font-size: 2.5em;
            font-weight: 700;
            letter-spacing: -1px;
            position: relative;
            z-index: 1;
        }
        
        .subtitle {
            font-size: 1.1em;
            opacity: 0.9;
            margin-top: 5px;
            font-weight: 300;
        }
        
        .tabs {
            display: flex;
            background: var(--bg);
            border-bottom: 2px solid var(--border);
            padding: 0 40px;
        }
        
        .tab {
            padding: 15px 30px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 1em;
            font-weight: 600;
            color: var(--text-muted);
            transition: all 0.3s;
            position: relative;
            font-family: 'Outfit', sans-serif;
        }
        
        .tab:hover {
            color: var(--primary);
        }
        
        .tab.active {
            color: var(--primary);
        }
        
        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--primary);
        }
        
        .content {
            padding: 40px;
        }
        
        .tab-content {
            display: none;
            animation: fadeIn 0.3s;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            box-shadow: var(--shadow);
            transition: all 0.3s;
        }
        
        .card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .card h3 {
            font-size: 1.2em;
            margin-bottom: 15px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Outfit', sans-serif;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }
        
        .btn-secondary {
            background: var(--secondary);
            color: white;
        }
        
        .btn-secondary:hover {
            background: #059669;
        }
        
        .btn-danger {
            background: var(--danger);
            color: white;
        }
        
        .btn-danger:hover {
            background: #dc2626;
        }
        
        .btn-warning {
            background: var(--warning);
            color: white;
        }
        
        .btn-small {
            padding: 5px 12px;
            font-size: 0.9em;
        }
        
        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 1em;
            font-family: 'Outfit', sans-serif;
            transition: border 0.3s;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: var(--text);
        }
        
        .calendar {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-top: 20px;
        }
        
        .month-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 15px;
            box-shadow: var(--shadow);
        }
        
        .month-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 15px;
            box-shadow: var(--shadow);
        }
        
        .vacation-summary {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 2px solid var(--border);
            max-height: 150px;
            overflow-y: auto;
        }
        
        .vacation-summary-title {
            font-size: 0.75em;
            font-weight: 700;
            color: var(--text-muted);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .vacation-person {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 4px 8px;
            margin-bottom: 4px;
            border-radius: 6px;
            font-size: 0.8em;
            transition: all 0.2s;
        }
        
        .vacation-person:hover {
            transform: translateX(3px);
        }
        
        .vacation-person.aprobado {
            background: rgba(134, 239, 172, 0.3);
            border-left: 3px solid var(--aprobado);
        }
        
        .vacation-person.pendiente {
            background: rgba(253, 224, 71, 0.3);
            border-left: 3px solid var(--pendiente);
        }
        
        .vacation-person.dias-2025 {
            background: rgba(192, 132, 252, 0.3);
            border-left: 3px solid var(--dias-2025);
        }
        
        .vacation-person-name {
            font-weight: 600;
            flex: 1;
        }
        
        .vacation-person-days {
            font-family: 'Space Mono', monospace;
            font-size: 0.85em;
            color: var(--text-muted);
            background: rgba(255,255,255,0.7);
            padding: 2px 6px;
            border-radius: 4px;
        }
        
        .vacation-person-icon {
            font-size: 1em;
        }
        
        .no-vacations {
            text-align: center;
            color: var(--text-muted);
            font-size: 0.75em;
            padding: 8px;
            font-style: italic;
        }
        
        .no-vacations {
            text-align: center;
            color: var(--text-muted);
            font-size: 0.75em;
            padding: 8px;
            font-style: italic;
        }
        
        .toggle-summary-btn {
            background: var(--bg);
            border: 1px solid var(--border);
            color: var(--primary);
            padding: 8px 15px;
            border-radius: 8px;
            font-size: 0.85em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: block;
            width: 100%;
            margin-bottom: 15px;
            font-family: 'Outfit', sans-serif;
        }
        
        .toggle-summary-btn:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .toggle-summary-btn.active {
            background: var(--primary);
            color: white;
        }
        
        .month-header {
            text-align: center;
            font-weight: 700;
            font-size: 1.1em;
            margin-bottom: 10px;
            color: var(--primary);
            padding-bottom: 10px;
            border-bottom: 2px solid var(--border);
        }
        
        .days-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 3px;
            margin-top: 10px;
        }
        
        .day-header {
            text-align: center;
            font-weight: 600;
            font-size: 0.75em;
            padding: 5px;
            color: var(--text-muted);
            font-family: 'Space Mono', monospace;
        }
        
        .day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            font-size: 0.85em;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            border: 1px solid transparent;
            font-family: 'Space Mono', monospace;
        }
        
        .day:hover:not(.empty):not(.festivo) {
            transform: scale(1.1);
            border-color: var(--primary);
        }
        
        .day.empty {
            cursor: default;
        }
        
        .day.festivo {
            background: var(--festivo);
            cursor: not-allowed;
            font-weight: 700;
        }
        
        .day.festivo-es {
            background: linear-gradient(135deg, #fca5a5 0%, #f87171 100%);
            cursor: not-allowed;
            font-weight: 700;
            position: relative;
        }
        
        .day.festivo-es::after {
            content: 'üá™üá∏';
            position: absolute;
            top: 2px;
            right: 2px;
            font-size: 0.6em;
        }
        
        .day.festivo-de {
            background: linear-gradient(135deg, #93c5fd 0%, #60a5fa 100%);
            cursor: not-allowed;
            font-weight: 700;
            position: relative;
        }
        
        .day.festivo-de::after {
            content: 'üá©üá™';
            position: absolute;
            top: 2px;
            right: 2px;
            font-size: 0.6em;
        }
        
        .day.festivo-both {
            background: linear-gradient(135deg, #fca5a5 0%, #93c5fd 100%);
            cursor: not-allowed;
            font-weight: 700;
            position: relative;
        }
        
        .day.festivo-both::after {
            content: 'üá™üá∏üá©üá™';
            position: absolute;
            top: 2px;
            right: 2px;
            font-size: 0.5em;
        }
        
        .day.aprobado {
            background: var(--aprobado);
            font-weight: 700;
        }
        
        .day.pendiente {
            background: var(--pendiente);
            font-weight: 700;
        }
        
        .day.dias-2025 {
            background: var(--dias-2025);
            font-weight: 700;
            border: 2px solid #9333ea;
        }
        
        .day.weekend {
            background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
            color: var(--text-muted);
            font-weight: 600;
        }
        
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            padding: 20px;
            background: var(--bg);
            border-radius: 12px;
            margin-bottom: 20px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9em;
        }
        
        .legend-color {
            width: 24px;
            height: 24px;
            border-radius: 6px;
            border: 1px solid var(--border);
        }
        
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: var(--shadow);
        }
        
        .stat-value {
            font-size: 2em;
            font-weight: 700;
            font-family: 'Space Mono', monospace;
        }
        
        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
            margin-top: 5px;
        }
        
        .employee-list {
            display: grid;
            gap: 10px;
        }
        
        .employee-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
        }
        
        .employee-card:hover {
            border-color: var(--primary);
            box-shadow: var(--shadow);
        }
        
        .employee-info {
            flex: 1;
        }
        
        .employee-name {
            font-weight: 700;
            font-size: 1.1em;
            margin-bottom: 5px;
        }
        
        .employee-stats {
            display: flex;
            gap: 15px;
            font-size: 0.9em;
            font-family: 'Space Mono', monospace;
        }
        
        .employee-stat {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .employee-actions {
            display: flex;
            gap: 10px;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: var(--surface);
            padding: 30px;
            border-radius: 16px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
            animation: slideUp 0.3s;
        }
        
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border);
        }
        
        .modal-title {
            font-size: 1.5em;
            font-weight: 700;
            color: var(--primary);
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            color: var(--text-muted);
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s;
        }
        
        .close-modal:hover {
            background: var(--bg);
            color: var(--danger);
        }
        
        .holiday-list {
            display: grid;
            gap: 10px;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 15px;
        }
        
        .holiday-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: var(--bg);
            border-radius: 8px;
            border: 1px solid var(--border);
        }
        
        .holiday-date {
            font-weight: 600;
            font-family: 'Space Mono', monospace;
        }
        
        .export-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 20px;
        }
        
        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
        }
        
        .alert-warning {
            background: #fef3c7;
            color: #92400e;
            border: 1px solid #fcd34d;
        }
        
        .alert-danger {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fca5a5;
        }
        
        .alert-info {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #93c5fd;
        }
        
        .alert-success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #86efac;
        }
        
        .vacation-request-list {
            display: grid;
            gap: 15px;
            margin-top: 20px;
        }
        
        .request-item {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            box-shadow: var(--shadow);
        }
        
        .request-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .request-employee {
            font-weight: 700;
            font-size: 1.2em;
        }
        
        .request-status {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
        }
        
        .request-status.pendiente {
            background: var(--pendiente);
            color: #854d0e;
        }
        
        .request-status.aprobado {
            background: var(--aprobado);
            color: #166534;
        }
        
        .request-dates {
            font-family: 'Space Mono', monospace;
            color: var(--text-muted);
            margin-bottom: 10px;
        }
        
        .request-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        
        .activity-log {
            max-height: 500px;
            overflow-y: auto;
            margin-top: 20px;
        }
        
        .activity-item {
            display: flex;
            gap: 15px;
            padding: 15px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            margin-bottom: 10px;
            transition: all 0.3s;
        }
        
        .activity-item:hover {
            box-shadow: var(--shadow);
            border-color: var(--primary);
        }
        
        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            flex-shrink: 0;
        }
        
        .activity-icon.create {
            background: #dbeafe;
            color: #1e40af;
        }
        
        .activity-icon.approve {
            background: #d1fae5;
            color: #065f46;
        }
        
        .activity-icon.delete {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .activity-content {
            flex: 1;
        }
        
        .activity-action {
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .activity-details {
            font-size: 0.9em;
            color: var(--text-muted);
        }
        
        .activity-time {
            font-size: 0.85em;
            color: var(--text-muted);
            font-family: 'Space Mono', monospace;
            margin-top: 5px;
        }
        
        @media (max-width: 768px) {
            .calendar {
                grid-template-columns: 1fr;
            }
            
            header {
                padding: 20px;
            }
            
            h1 {
                font-size: 1.8em;
            }
            
            .content {
                padding: 20px;
            }
            
            .tabs {
                padding: 0 20px;
                overflow-x: auto;
            }
        }
        
        .year-selector {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            padding: 20px;
            background: var(--bg);
            border-radius: 12px;
        }
        
        .year-btn {
            padding: 10px 30px;
            border: 2px solid var(--primary);
            background: white;
            color: var(--primary);
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Outfit', sans-serif;
        }
        
        .year-btn.active {
            background: var(--primary);
            color: white;
        }
        
        .year-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üèñÔ∏è VacaPanel</h1>
            <div class="subtitle">Sistema de Gesti√≥n de Vacaciones del Departamento</div>
        </header>
        
        <div class="tabs">
            <button class="tab active" onclick="switchTab('calendario')">üìÖ Calendario</button>
            <button class="tab" onclick="switchTab('empleados')">üë• Empleados</button>
            <button class="tab" onclick="switchTab('solicitudes')">üìù Solicitudes</button>
            <button class="tab" onclick="switchTab('historial')">üìã Historial</button>
            <button class="tab" onclick="switchTab('festivos')">üéâ Festivos</button>
            <button class="tab" onclick="switchTab('configuracion')">‚öôÔ∏è Configuraci√≥n</button>
        </div>
        
        <div class="content">
            <!-- CALENDARIO -->
            <div id="calendario" class="tab-content active">
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: linear-gradient(135deg, #fca5a5 0%, #f87171 100%)">üá™üá∏</div>
                        <span>Festivo Espa√±a</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: linear-gradient(135deg, #93c5fd 0%, #60a5fa 100%)">üá©üá™</div>
                        <span>Festivo Alemania</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: linear-gradient(135deg, #fca5a5 0%, #93c5fd 100%)">üá™üá∏üá©üá™</div>
                        <span>Festivo Ambos Pa√≠ses</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: var(--aprobado)"></div>
                        <span>Vacaciones Aprobadas</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: var(--pendiente)"></div>
                        <span>Pendiente de Aprobaci√≥n</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: var(--dias-2025); border: 2px solid #9333ea"></div>
                        <span>D√≠as de 2025 (Acumulados)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%)"></div>
                        <span>Fin de Semana</span>
                    </div>
                </div>
                
                <div class="year-selector">
                    <button class="year-btn" onclick="changeYear(2025)">2025</button>
                    <button class="year-btn active" onclick="changeYear(2026)">2026</button>
                </div>
                
                <div class="stats-container">
                    <div class="stat-card">
                        <div class="stat-value" id="totalEmployees">0</div>
                        <div class="stat-label">Empleados</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, var(--secondary) 0%, #059669 100%)">
                        <div class="stat-value" id="totalApproved">0</div>
                        <div class="stat-label">D√≠as Aprobados</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, var(--warning) 0%, #d97706 100%)">
                        <div class="stat-value" id="totalPending">0</div>
                        <div class="stat-label">D√≠as Pendientes</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, var(--info) 0%, #7c3aed 100%)">
                        <div class="stat-value" id="totalDays2025">0</div>
                        <div class="stat-label">D√≠as de 2025</div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Filtrar por empleado:</label>
                    <select id="employeeFilter" onchange="renderCalendar()">
                        <option value="">Todos los empleados</option>
                    </select>
                </div>
                
                <button class="toggle-summary-btn active" id="toggleSummaryBtn" onclick="toggleVacationSummaries()">
                    üëÅÔ∏è Resumen de Vacaciones Visible
                </button>
                
                <div id="calendarContainer" class="calendar"></div>
            </div>
            
            <!-- EMPLEADOS -->
            <div id="empleados" class="tab-content">
                <div class="card">
                    <h3>‚ûï A√±adir Nuevo Empleado</h3>
                    <div class="form-group">
                        <label>Nombre del empleado:</label>
                        <input type="text" id="newEmployeeName" placeholder="Ej: Juan P√©rez">
                    </div>
                    <div class="form-group">
                        <label>D√≠as de vacaciones 2026:</label>
                        <input type="number" id="newEmployeeDays2026" value="23" min="0">
                    </div>
                    <div class="form-group">
                        <label>D√≠as de vacaciones 2025 (acumulados):</label>
                        <input type="number" id="newEmployeeDays2025" value="0" min="0">
                    </div>
                    <button class="btn btn-primary" onclick="addEmployee()">A√±adir Empleado</button>
                </div>
                
                <div style="margin-top: 30px;">
                    <h3 style="margin-bottom: 20px;">Lista de Empleados</h3>
                    <div id="employeeList" class="employee-list"></div>
                </div>
            </div>
            
            <!-- SOLICITUDES -->
            <div id="solicitudes" class="tab-content">
                <div class="card">
                    <h3>üìù Nueva Solicitud de Vacaciones</h3>
                    <div class="form-group">
                        <label>Empleado:</label>
                        <select id="requestEmployee"></select>
                    </div>
                    <div class="form-group">
                        <label>A√±o:</label>
                        <select id="requestYear" onchange="updateYearSelection()">
                            <option value="2026">2026</option>
                            <option value="2025">2025 (Acumulados)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Fecha de inicio:</label>
                        <input type="date" id="requestStartDate">
                    </div>
                    <div class="form-group">
                        <label>Fecha de fin:</label>
                        <input type="date" id="requestEndDate">
                    </div>
                    <div id="requestWarning"></div>
                    <div class="export-buttons">
                        <button class="btn btn-primary" onclick="createRequest()">Crear Solicitud</button>
                        <button class="btn btn-secondary" onclick="exportRequest('clipboard')">üìã Copiar al Portapapeles</button>
                        <button class="btn btn-warning" onclick="exportRequest('image')">üñºÔ∏è Exportar como Imagen</button>
                    </div>
                </div>
                
                <div style="margin-top: 30px;">
                    <h3 style="margin-bottom: 20px;">Solicitudes Pendientes y Aprobadas</h3>
                    <div id="requestList" class="vacation-request-list"></div>
                </div>
            </div>
            
            
            <!-- HISTORIAL -->
            <div id="historial" class="tab-content">
                <div class="card">
                    <h3>üìã Historial de Actividad P√∫blica</h3>
                    <p style="color: var(--text-muted); margin-bottom: 20px;">
                        Registro completo de todas las acciones realizadas: solicitudes, aprobaciones y eliminaciones.
                    </p>
                    <div id="activityLog" class="activity-log"></div>
                </div>
            </div>
            
            <!-- FESTIVOS -->
            <div id="festivos" class="tab-content">
                <div class="card">
                    <h3>‚ûï A√±adir D√≠a Festivo</h3>
                    <div class="form-group">
                        <label>Pa√≠s:</label>
                        <select id="holidayCountry">
                            <option value="es">üá™üá∏ Espa√±a</option>
                            <option value="de">üá©üá™ Alemania</option>
                            <option value="both">üá™üá∏üá©üá™ Ambos pa√≠ses</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>A√±o:</label>
                        <select id="holidayYear">
                            <option value="2025">2025</option>
                            <option value="2026">2026</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Fecha:</label>
                        <input type="date" id="holidayDate">
                    </div>
                    <div class="form-group">
                        <label>Descripci√≥n:</label>
                        <input type="text" id="holidayDescription" placeholder="Ej: A√±o Nuevo">
                    </div>
                    <button class="btn btn-primary" onclick="addHoliday()">A√±adir Festivo</button>
                </div>
                
                <div style="margin-top: 30px;">
                    <h3 style="margin-bottom: 20px;">D√≠as Festivos 2025</h3>
                    <div id="holidays2025List" class="holiday-list"></div>
                </div>
                
                <div style="margin-top: 30px;">
                    <h3 style="margin-bottom: 20px;">D√≠as Festivos 2026</h3>
                    <div id="holidays2026List" class="holiday-list"></div>
                </div>
            </div>
            
            <!-- CONFIGURACI√ìN -->
            <div id="configuracion" class="tab-content">
                <div class="grid">
                    <div class="card">
                        <h3>üíæ Exportar Datos</h3>
                        <p style="margin-bottom: 15px;">Descarga una copia de seguridad de todos los datos.</p>
                        <button class="btn btn-secondary" onclick="exportData()">Exportar Datos</button>
                    </div>
                    
                    <div class="card">
                        <h3>üì• Importar Datos</h3>
                        <p style="margin-bottom: 15px;">Restaura una copia de seguridad anterior.</p>
                        <input type="file" id="importFile" accept=".json" style="margin-bottom: 10px;">
                        <button class="btn btn-warning" onclick="importData()">Importar Datos</button>
                    </div>
                    
                    <div class="card">
                        <h3>üóëÔ∏è Resetear Sistema</h3>
                        <p style="margin-bottom: 15px;">Elimina todos los datos y vuelve a los valores por defecto.</p>
                        <button class="btn btn-danger" onclick="resetSystem()">Resetear Todo</button>
                    </div>
                </div>
                
                <div class="card" style="margin-top: 20px;">
                    <h3>‚ÑπÔ∏è Informaci√≥n del Sistema</h3>
                    <p><strong>Versi√≥n:</strong> VacaPanel 1.0</p>
                    <p><strong>Almacenamiento:</strong> LocalStorage del navegador</p>
                    <p><strong>√öltima actualizaci√≥n:</strong> <span id="lastUpdate">-</span></p>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // ==================== ESTADO GLOBAL ====================
        let state = {
            employees: [],
            holidays2025: [],
            holidays2026: [],
            vacationRequests: [],
            activityLog: [],
            currentYear: 2026
        };
        
        let showVacationSummaries = true;
        
        const MONTHS = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];
        const DAYS = ['L', 'M', 'X', 'J', 'V', 'S', 'D'];
        
        // ==================== TOGGLE VACATION SUMMARIES ====================
        function toggleVacationSummaries() {
            showVacationSummaries = !showVacationSummaries;
            const btn = document.getElementById('toggleSummaryBtn');
            
            if (showVacationSummaries) {
                btn.textContent = 'üëÅÔ∏è Resumen de Vacaciones Visible';
                btn.classList.add('active');
            } else {
                btn.textContent = 'üëÅÔ∏è‚Äçüó®Ô∏è Mostrar Resumen de Vacaciones';
                btn.classList.remove('active');
            }
            
            renderCalendar();
        }
        
        // ==================== INICIALIZACI√ìN ====================
        function init() {
            loadFromStorage();
            initializeDefaultHolidays();
            renderAll();
            updateLastUpdate();
        }
        
        function loadFromStorage() {
            const saved = localStorage.getItem('vacapanel_data');
            if (saved) {
                state = JSON.parse(saved);
            }
        }
        
        function saveToStorage() {
            localStorage.setItem('vacapanel_data', JSON.stringify(state));
            updateLastUpdate();
        }
        
        function updateLastUpdate() {
            const now = new Date();
            document.getElementById('lastUpdate').textContent = now.toLocaleString('es-ES');
        }
        
        function initializeDefaultHolidays() {
            if (state.holidays2026.length === 0) {
                state.holidays2026 = [
                    { date: '2026-01-01', description: 'A√±o Nuevo', country: 'both' },
                    { date: '2026-01-06', description: 'Reyes Magos', country: 'es' },
                    { date: '2026-04-03', description: 'Viernes Santo', country: 'both' },
                    { date: '2026-04-06', description: 'Lunes de Pascua', country: 'de' },
                    { date: '2026-05-01', description: 'D√≠a del Trabajador', country: 'both' },
                    { date: '2026-05-14', description: 'Ascensi√≥n', country: 'de' },
                    { date: '2026-08-15', description: 'Asunci√≥n de la Virgen', country: 'es' },
                    { date: '2026-10-03', description: 'D√≠a de la Unidad Alemana', country: 'de' },
                    { date: '2026-10-12', description: 'Fiesta Nacional', country: 'es' },
                    { date: '2026-11-01', description: 'Todos los Santos', country: 'es' },
                    { date: '2026-12-06', description: 'D√≠a de la Constituci√≥n', country: 'es' },
                    { date: '2026-12-08', description: 'Inmaculada Concepci√≥n', country: 'es' },
                    { date: '2026-12-25', description: 'Navidad', country: 'both' },
                    { date: '2026-12-26', description: 'San Esteban', country: 'de' }
                ];
                saveToStorage();
            }
        }
        
        // ==================== NAVEGACI√ìN ====================
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
            
            if (tabName === 'calendario') renderCalendar();
            if (tabName === 'empleados') renderEmployeeList();
            if (tabName === 'solicitudes') renderRequestList();
            if (tabName === 'historial') renderActivityLog();
            if (tabName === 'festivos') renderHolidayLists();
        }
        
        function changeYear(year) {
            state.currentYear = year;
            document.querySelectorAll('.year-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            renderCalendar();
        }
        
        // ==================== ACTIVITY LOG ====================
        function logActivity(action, details, performedBy = 'Sistema') {
            const activity = {
                id: Date.now(),
                action,
                details,
                performedBy,
                timestamp: new Date().toISOString()
            };
            
            state.activityLog.unshift(activity); // Add to beginning
            saveToStorage();
        }
        
        function renderActivityLog() {
            const container = document.getElementById('activityLog');
            
            if (state.activityLog.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--text-muted); padding: 40px;">No hay actividad registrada todav√≠a.</p>';
                return;
            }
            
            container.innerHTML = state.activityLog.map(activity => {
                let icon = 'üìù';
                let iconClass = 'create';
                
                if (activity.action === 'approve') {
                    icon = '‚úÖ';
                    iconClass = 'approve';
                } else if (activity.action === 'delete') {
                    icon = 'üóëÔ∏è';
                    iconClass = 'delete';
                }
                
                return `
                    <div class="activity-item">
                        <div class="activity-icon ${iconClass}">${icon}</div>
                        <div class="activity-content">
                            <div class="activity-action">${getActivityActionText(activity)}</div>
                            <div class="activity-details">${activity.details}</div>
                            <div class="activity-time">
                                ${new Date(activity.timestamp).toLocaleString('es-ES', {
                                    day: '2-digit',
                                    month: '2-digit',
                                    year: 'numeric',
                                    hour: '2-digit',
                                    minute: '2-digit',
                                    second: '2-digit'
                                })}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function getActivityActionText(activity) {
            switch(activity.action) {
                case 'create':
                    return 'üìù Nueva Solicitud Creada';
                case 'approve':
                    return '‚úÖ Solicitud Aprobada';
                case 'delete':
                    return 'üóëÔ∏è Solicitud Eliminada';
                default:
                    return activity.action;
            }
        }
        
        // ==================== EMPLEADOS ====================
        function addEmployee() {
            const name = document.getElementById('newEmployeeName').value.trim();
            const days2026 = parseInt(document.getElementById('newEmployeeDays2026').value) || 23;
            const days2025 = parseInt(document.getElementById('newEmployeeDays2025').value) || 0;
            
            if (!name) {
                alert('Por favor, introduce un nombre');
                return;
            }
            
            const employee = {
                id: Date.now(),
                name,
                days2026Total: days2026,
                days2025Total: days2025,
                days2026Used: 0,
                days2025Used: 0
            };
            
            state.employees.push(employee);
            saveToStorage();
            
            document.getElementById('newEmployeeName').value = '';
            document.getElementById('newEmployeeDays2026').value = '23';
            document.getElementById('newEmployeeDays2025').value = '0';
            
            renderAll();
        }
        
        function deleteEmployee(id) {
            if (confirm('¬øEst√°s seguro de eliminar este empleado? Se borrar√°n todas sus solicitudes de vacaciones.')) {
                state.employees = state.employees.filter(e => e.id !== id);
                state.vacationRequests = state.vacationRequests.filter(r => r.employeeId !== id);
                saveToStorage();
                renderAll();
            }
        }
        
        function renderEmployeeList() {
            const container = document.getElementById('employeeList');
            
            if (state.employees.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--text-muted); padding: 40px;">No hay empleados registrados. A√±ade el primero arriba.</p>';
                return;
            }
            
            container.innerHTML = state.employees.map(emp => {
                const available2026 = emp.days2026Total - emp.days2026Used;
                const available2025 = emp.days2025Total - emp.days2025Used;
                const pending2026 = getPendingDays(emp.id, 2026);
                const pending2025 = getPendingDays(emp.id, 2025);
                
                return `
                    <div class="employee-card">
                        <div class="employee-info">
                            <div class="employee-name">${emp.name}</div>
                            <div class="employee-stats">
                                <div class="employee-stat">
                                    <span>2026:</span>
                                    <strong>${available2026}/${emp.days2026Total}</strong>
                                    ${pending2026 > 0 ? `<span style="color: var(--warning)">(${pending2026} pendientes)</span>` : ''}
                                </div>
                                ${emp.days2025Total > 0 ? `
                                    <div class="employee-stat">
                                        <span>2025:</span>
                                        <strong style="color: var(--info)">${available2025}/${emp.days2025Total}</strong>
                                        ${pending2025 > 0 ? `<span style="color: var(--warning)">(${pending2025} pendientes)</span>` : ''}
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                        <div class="employee-actions">
                            <button class="btn btn-danger btn-small" onclick="deleteEmployee(${emp.id})">Eliminar</button>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function getPendingDays(employeeId, year) {
            return state.vacationRequests
                .filter(r => r.employeeId === employeeId && r.year === year && r.status === 'pendiente')
                .reduce((sum, r) => sum + r.days.length, 0);
        }
        
        // ==================== CALENDARIO ====================
        function renderCalendar() {
            const container = document.getElementById('calendarContainer');
            const year = state.currentYear;
            const filter = document.getElementById('employeeFilter')?.value || '';
            
            container.innerHTML = '';
            
            for (let month = 0; month < 12; month++) {
                const monthCard = document.createElement('div');
                monthCard.className = 'month-card';
                
                const monthHeader = document.createElement('div');
                monthHeader.className = 'month-header';
                monthHeader.textContent = `${MONTHS[month]} ${year}`;
                monthCard.appendChild(monthHeader);
                
                const daysGrid = document.createElement('div');
                daysGrid.className = 'days-grid';
                
                // Headers
                DAYS.forEach(day => {
                    const header = document.createElement('div');
                    header.className = 'day-header';
                    header.textContent = day;
                    daysGrid.appendChild(header);
                });
                
                // Days
                const firstDay = new Date(year, month, 1);
                const lastDay = new Date(year, month + 1, 0);
                const startDay = (firstDay.getDay() + 6) % 7; // Lunes = 0
                
                // Empty cells
                for (let i = 0; i < startDay; i++) {
                    const empty = document.createElement('div');
                    empty.className = 'day empty';
                    daysGrid.appendChild(empty);
                }
                
                // Actual days
                for (let day = 1; day <= lastDay.getDate(); day++) {
                    const dayDiv = document.createElement('div');
                    dayDiv.className = 'day';
                    dayDiv.textContent = day;
                    
                    const date = new Date(year, month, day);
                    const dateStr = formatDate(date);
                    const dayOfWeek = date.getDay();
                    
                    // Weekend
                    if (dayOfWeek === 0 || dayOfWeek === 6) {
                        dayDiv.classList.add('weekend');
                    }
                    
                    // Holiday
                    const holidays = year === 2025 ? state.holidays2025 : state.holidays2026;
                    const holiday = holidays.find(h => h.date === dateStr);
                    
                    if (holiday) {
                        const country = holiday.country || 'es';
                        if (country === 'both') {
                            dayDiv.classList.add('festivo-both');
                        } else if (country === 'de') {
                            dayDiv.classList.add('festivo-de');
                        } else {
                            dayDiv.classList.add('festivo-es');
                        }
                        dayDiv.title = `${holiday.description} ${country === 'both' ? '(ES/DE)' : country === 'de' ? '(DE)' : '(ES)'}`;
                    } else {
                        // Vacation status
                        const requests = getRequestsForDate(dateStr, filter);
                        if (requests.length > 0) {
                            const hasApproved = requests.some(r => r.status === 'aprobado');
                            const hasPending = requests.some(r => r.status === 'pendiente');
                            const has2025 = requests.some(r => r.year === 2025);
                            
                            if (has2025 && hasApproved) {
                                dayDiv.classList.add('dias-2025');
                            } else if (hasApproved) {
                                dayDiv.classList.add('aprobado');
                            } else if (hasPending) {
                                dayDiv.classList.add('pendiente');
                            }
                            
                            dayDiv.title = requests.map(r => {
                                const emp = state.employees.find(e => e.id === r.employeeId);
                                return `${emp.name} (${r.status}, ${r.year})`;
                            }).join('\n');
                        }
                    }
                    
                    daysGrid.appendChild(dayDiv);
                }
                
                monthCard.appendChild(daysGrid);
                
                // Add vacation summary if enabled
                if (showVacationSummaries) {
                    const summary = getMonthVacationSummary(year, month, filter);
                    monthCard.appendChild(summary);
                }
                
                container.appendChild(monthCard);
            }
            
            updateStats();
        }
        
        function getMonthVacationSummary(year, month, employeeFilter) {
            const summaryDiv = document.createElement('div');
            summaryDiv.className = 'vacation-summary';
            
            const title = document.createElement('div');
            title.className = 'vacation-summary-title';
            title.textContent = 'üèñÔ∏è Vacaciones en este mes';
            summaryDiv.appendChild(title);
            
            // Get all vacation requests for this month
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            
            const vacationsByEmployee = new Map();
            
            state.vacationRequests.forEach(request => {
                if (employeeFilter && request.employeeId !== parseInt(employeeFilter)) return;
                
                // Count days in this month
                const daysInMonth = request.days.filter(day => {
                    const d = new Date(day);
                    return d >= firstDay && d <= lastDay;
                }).length;
                
                if (daysInMonth > 0) {
                    const key = `${request.employeeId}-${request.status}-${request.year}`;
                    if (!vacationsByEmployee.has(key)) {
                        vacationsByEmployee.set(key, {
                            employeeId: request.employeeId,
                            status: request.status,
                            year: request.year,
                            days: 0
                        });
                    }
                    vacationsByEmployee.get(key).days += daysInMonth;
                }
            });
            
            if (vacationsByEmployee.size === 0) {
                const noVacations = document.createElement('div');
                noVacations.className = 'no-vacations';
                noVacations.textContent = 'Sin vacaciones programadas';
                summaryDiv.appendChild(noVacations);
            } else {
                // Sort by employee name
                const sorted = Array.from(vacationsByEmployee.values()).sort((a, b) => {
                    const empA = state.employees.find(e => e.id === a.employeeId);
                    const empB = state.employees.find(e => e.id === b.employeeId);
                    return empA.name.localeCompare(empB.name);
                });
                
                sorted.forEach(vacation => {
                    const employee = state.employees.find(e => e.id === vacation.employeeId);
                    const personDiv = document.createElement('div');
                    
                    let className = 'vacation-person ';
                    let icon = '';
                    
                    if (vacation.year === 2025) {
                        className += 'dias-2025';
                        icon = 'üü£';
                    } else if (vacation.status === 'aprobado') {
                        className += 'aprobado';
                        icon = '‚úÖ';
                    } else {
                        className += 'pendiente';
                        icon = '‚è≥';
                    }
                    
                    personDiv.className = className;
                    personDiv.innerHTML = `
                        <span class="vacation-person-icon">${icon}</span>
                        <span class="vacation-person-name">${employee.name}</span>
                        <span class="vacation-person-days">${vacation.days}d</span>
                    `;
                    
                    summaryDiv.appendChild(personDiv);
                });
            }
            
            return summaryDiv;
        }
        
        function getRequestsForDate(date, employeeFilter) {
            return state.vacationRequests.filter(r => {
                if (employeeFilter && r.employeeId !== parseInt(employeeFilter)) return false;
                return r.days.includes(date);
            });
        }
        
        function updateStats() {
            document.getElementById('totalEmployees').textContent = state.employees.length;
            
            const approved = state.vacationRequests
                .filter(r => r.status === 'aprobado')
                .reduce((sum, r) => sum + r.days.length, 0);
            document.getElementById('totalApproved').textContent = approved;
            
            const pending = state.vacationRequests
                .filter(r => r.status === 'pendiente')
                .reduce((sum, r) => sum + r.days.length, 0);
            document.getElementById('totalPending').textContent = pending;
            
            const days2025 = state.vacationRequests
                .filter(r => r.year === 2025)
                .reduce((sum, r) => sum + r.days.length, 0);
            document.getElementById('totalDays2025').textContent = days2025;
        }
        
        // ==================== SOLICITUDES ====================
        function createRequest() {
            const employeeId = parseInt(document.getElementById('requestEmployee').value);
            const year = parseInt(document.getElementById('requestYear').value);
            const startDate = document.getElementById('requestStartDate').value;
            const endDate = document.getElementById('requestEndDate').value;
            
            if (!employeeId || !startDate || !endDate) {
                alert('Por favor, completa todos los campos');
                return;
            }
            
            if (new Date(startDate) > new Date(endDate)) {
                alert('La fecha de inicio debe ser anterior a la fecha de fin');
                return;
            }
            
            const days = getWorkingDaysBetween(startDate, endDate, year);
            const employee = state.employees.find(e => e.id === employeeId);
            
            // Validaci√≥n de d√≠as disponibles
            const totalAvailable = year === 2026 ? 
                (employee.days2026Total - employee.days2026Used) : 
                (employee.days2025Total - employee.days2025Used);
            
            const pendingDays = getPendingDays(employeeId, year);
            const availableAfterPending = totalAvailable - pendingDays;
            
            if (days.length > availableAfterPending) {
                alert(`No hay suficientes d√≠as disponibles. Disponibles: ${availableAfterPending}, Solicitados: ${days.length}`);
                return;
            }
            
            // Validaci√≥n de solapamiento
            const overlapWarning = checkOverlapWarning(days);
            if (overlapWarning) {
                const warningDiv = document.getElementById('requestWarning');
                warningDiv.innerHTML = `<div class="alert alert-danger">${overlapWarning}</div>`;
                
                if (!confirm(overlapWarning + '\n\n¬øDeseas continuar con la solicitud?')) {
                    return;
                }
            }
            
            const request = {
                id: Date.now(),
                employeeId,
                year,
                days,
                status: 'pendiente',
                createdAt: new Date().toISOString()
            };
            
            state.vacationRequests.push(request);
            
            // Log activity
            logActivity(
                'create',
                `${employee.name} solicit√≥ ${days.length} d√≠as de vacaciones (${year}) del ${formatDateES(startDate)} al ${formatDateES(endDate)}`,
                employee.name
            );
            
            saveToStorage();
            
            document.getElementById('requestStartDate').value = '';
            document.getElementById('requestEndDate').value = '';
            document.getElementById('requestWarning').innerHTML = '';
            
            alert('Solicitud creada correctamente');
            renderAll();
        }
        
        function getWorkingDaysBetween(start, end, year) {
            const days = [];
            const startDate = new Date(start);
            const endDate = new Date(end);
            const holidays = year === 2025 ? state.holidays2025 : state.holidays2026;
            
            for (let d = new Date(startDate); d <= endDate; d.setDate(d.getDate() + 1)) {
                const dayOfWeek = d.getDay();
                const dateStr = formatDate(d);
                
                // Skip weekends and holidays
                if (dayOfWeek !== 0 && dayOfWeek !== 6 && !holidays.some(h => h.date === dateStr)) {
                    days.push(dateStr);
                }
            }
            
            return days;
        }
        
        function checkOverlapWarning(days) {
            const totalEmployees = state.employees.length;
            const threshold = Math.floor(totalEmployees / 2);
            
            const warningDays = [];
            
            for (const day of days) {
                const onVacation = new Set();
                const employeeNames = [];
                
                state.vacationRequests
                    .filter(r => r.days.includes(day))
                    .forEach(r => {
                        onVacation.add(r.employeeId);
                        const emp = state.employees.find(e => e.id === r.employeeId);
                        if (emp) employeeNames.push(emp.name);
                    });
                
                if (onVacation.size >= threshold) {
                    warningDays.push({
                        date: day,
                        count: onVacation.size,
                        names: employeeNames
                    });
                }
            }
            
            if (warningDays.length > 0) {
                const details = warningDays.map(wd => 
                    `${formatDateES(wd.date)}: ${wd.count} empleados (${wd.names.join(', ')})`
                ).join('\n');
                
                return `‚ö†Ô∏è ADVERTENCIA: Se ha superado el l√≠mite de ${threshold} empleados de vacaciones simult√°neas:\n\n${details}`;
            }
            
            return null;
        }
        
        function approveRequest(id) {
            const request = state.vacationRequests.find(r => r.id === id);
            if (!request) return;
            
            const employee = state.employees.find(e => e.id === request.employeeId);
            
            if (request.year === 2026) {
                employee.days2026Used += request.days.length;
            } else {
                employee.days2025Used += request.days.length;
            }
            
            request.status = 'aprobado';
            
            // Log activity
            logActivity(
                'approve',
                `Aprobadas ${request.days.length} d√≠as de vacaciones de ${employee.name} (${request.year}) - Del ${formatDateES(request.days[0])} al ${formatDateES(request.days[request.days.length - 1])}`,
                'RRHH'
            );
            
            saveToStorage();
            renderAll();
        }
        
        function deleteRequest(id) {
            const request = state.vacationRequests.find(r => r.id === id);
            if (!request) return;
            
            const employee = state.employees.find(e => e.id === request.employeeId);
            
            if (confirm(`¬øEst√°s seguro de eliminar la solicitud de ${employee.name}?`)) {
                
                if (request.status === 'aprobado') {
                    const affectedEmployee = state.employees.find(e => e.id === request.employeeId);
                    if (request.year === 2026) {
                        affectedEmployee.days2026Used -= request.days.length;
                    } else {
                        affectedEmployee.days2025Used -= request.days.length;
                    }
                }
                
                // Log activity
                logActivity(
                    'delete',
                    `Eliminada solicitud de ${employee.name}: ${request.days.length} d√≠as (${request.year}, ${request.status}) - Del ${formatDateES(request.days[0])} al ${formatDateES(request.days[request.days.length - 1])}`,
                    'Usuario del sistema'
                );
                
                state.vacationRequests = state.vacationRequests.filter(r => r.id !== id);
                saveToStorage();
                renderAll();
            }
        }
        
        function renderRequestList() {
            const container = document.getElementById('requestList');
            const employeeSelect = document.getElementById('requestEmployee');
            
            employeeSelect.innerHTML = '<option value="">Selecciona un empleado</option>' + 
                state.employees.map(e => `<option value="${e.id}">${e.name}</option>`).join('');
            
            if (state.vacationRequests.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--text-muted); padding: 40px;">No hay solicitudes de vacaciones.</p>';
                return;
            }
            
            const sorted = [...state.vacationRequests].sort((a, b) => {
                if (a.status !== b.status) return a.status === 'pendiente' ? -1 : 1;
                return new Date(b.createdAt) - new Date(a.createdAt);
            });
            
            container.innerHTML = sorted.map(req => {
                const employee = state.employees.find(e => e.id === req.employeeId);
                const startDate = req.days[0];
                const endDate = req.days[req.days.length - 1];
                
                return `
                    <div class="request-item">
                        <div class="request-header">
                            <div class="request-employee">${employee.name}</div>
                            <div class="request-status ${req.status}">${req.status.toUpperCase()}</div>
                        </div>
                        <div class="request-dates">
                            üìÖ ${formatDateES(startDate)} - ${formatDateES(endDate)} (${req.days.length} d√≠as)
                            ${req.year === 2025 ? '<br>üü£ D√≠as de 2025 (acumulados)' : ''}
                        </div>
                        <div class="request-actions">
                            ${req.status === 'pendiente' ? `
                                <button class="btn btn-secondary btn-small" onclick="approveRequest(${req.id})">‚úì Aprobar</button>
                            ` : ''}
                            <button class="btn btn-danger btn-small" onclick="deleteRequest(${req.id})">‚úó Eliminar</button>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function exportRequest(type) {
            const employeeId = parseInt(document.getElementById('requestEmployee').value);
            const year = parseInt(document.getElementById('requestYear').value);
            const startDate = document.getElementById('requestStartDate').value;
            const endDate = document.getElementById('requestEndDate').value;
            
            if (!employeeId || !startDate || !endDate) {
                alert('Por favor, completa todos los campos antes de exportar');
                return;
            }
            
            const employee = state.employees.find(e => e.id === employeeId);
            const days = getWorkingDaysBetween(startDate, endDate, year);
            
            const text = `
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       SOLICITUD DE VACACIONES
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

Empleado: ${employee.name}
A√±o: ${year}${year === 2025 ? ' (D√≠as acumulados)' : ''}
Per√≠odo: ${formatDateES(startDate)} - ${formatDateES(endDate)}
Total de d√≠as: ${days.length}

D√≠as solicitados:
${days.map(d => `  ‚Ä¢ ${formatDateES(d)}`).join('\n')}

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
Generado por VacaPanel el ${new Date().toLocaleString('es-ES')}
            `.trim();
            
            if (type === 'clipboard') {
                navigator.clipboard.writeText(text).then(() => {
                    alert('‚úì Solicitud copiada al portapapeles. Ahora puedes pegarla en tu email a RRHH.');
                });
            } else if (type === 'image') {
                // Create canvas
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                canvas.width = 800;
                canvas.height = 600;
                
                // Background
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // Header
                ctx.fillStyle = '#2563eb';
                ctx.fillRect(0, 0, canvas.width, 100);
                
                ctx.fillStyle = '#ffffff';
                ctx.font = 'bold 32px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('SOLICITUD DE VACACIONES', canvas.width / 2, 60);
                
                // Content
                ctx.fillStyle = '#1e293b';
                ctx.font = '20px Arial';
                ctx.textAlign = 'left';
                
                let y = 150;
                const lines = [
                    `Empleado: ${employee.name}`,
                    `A√±o: ${year}${year === 2025 ? ' (D√≠as acumulados)' : ''}`,
                    `Per√≠odo: ${formatDateES(startDate)} - ${formatDateES(endDate)}`,
                    `Total de d√≠as: ${days.length}`,
                    '',
                    'D√≠as solicitados:'
                ];
                
                lines.forEach(line => {
                    ctx.fillText(line, 50, y);
                    y += 30;
                });
                
                days.slice(0, 10).forEach(d => {
                    ctx.fillText(`  ‚Ä¢ ${formatDateES(d)}`, 70, y);
                    y += 25;
                });
                
                if (days.length > 10) {
                    ctx.fillText(`  ... y ${days.length - 10} d√≠as m√°s`, 70, y);
                }
                
                // Download
                canvas.toBlob(blob => {
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `solicitud_vacaciones_${employee.name}_${year}.png`;
                    a.click();
                });
            }
        }
        
        // ==================== FESTIVOS ====================
        function addHoliday() {
            const country = document.getElementById('holidayCountry').value;
            const year = parseInt(document.getElementById('holidayYear').value);
            const date = document.getElementById('holidayDate').value;
            const description = document.getElementById('holidayDescription').value.trim();
            
            if (!date || !description) {
                alert('Por favor, completa todos los campos');
                return;
            }
            
            const holidays = year === 2025 ? state.holidays2025 : state.holidays2026;
            
            if (holidays.some(h => h.date === date)) {
                alert('Ya existe un festivo en esa fecha');
                return;
            }
            
            holidays.push({ date, description, country });
            holidays.sort((a, b) => new Date(a.date) - new Date(b.date));
            
            saveToStorage();
            
            document.getElementById('holidayDate').value = '';
            document.getElementById('holidayDescription').value = '';
            document.getElementById('holidayCountry').value = 'es';
            
            renderHolidayLists();
            renderCalendar();
        }
        
        function deleteHoliday(year, date) {
            if (confirm('¬øEst√°s seguro de eliminar este festivo?')) {
                if (year === 2025) {
                    state.holidays2025 = state.holidays2025.filter(h => h.date !== date);
                } else {
                    state.holidays2026 = state.holidays2026.filter(h => h.date !== date);
                }
                saveToStorage();
                renderHolidayLists();
                renderCalendar();
            }
        }
        
        function renderHolidayLists() {
            const container2025 = document.getElementById('holidays2025List');
            const container2026 = document.getElementById('holidays2026List');
            
            const getCountryFlag = (country) => {
                if (country === 'both') return 'üá™üá∏üá©üá™';
                if (country === 'de') return 'üá©üá™';
                return 'üá™üá∏';
            };
            
            container2025.innerHTML = state.holidays2025.length === 0 ? 
                '<p style="text-align: center; color: var(--text-muted); padding: 20px;">No hay festivos para 2025</p>' :
                state.holidays2025.map(h => `
                    <div class="holiday-item">
                        <div>
                            <div class="holiday-date">${getCountryFlag(h.country || 'es')} ${formatDateES(h.date)}</div>
                            <div style="color: var(--text-muted); font-size: 0.9em;">${h.description}</div>
                        </div>
                        <button class="btn btn-danger btn-small" onclick="deleteHoliday(2025, '${h.date}')">Eliminar</button>
                    </div>
                `).join('');
            
            container2026.innerHTML = state.holidays2026.length === 0 ? 
                '<p style="text-align: center; color: var(--text-muted); padding: 20px;">No hay festivos para 2026</p>' :
                state.holidays2026.map(h => `
                    <div class="holiday-item">
                        <div>
                            <div class="holiday-date">${getCountryFlag(h.country || 'es')} ${formatDateES(h.date)}</div>
                            <div style="color: var(--text-muted); font-size: 0.9em;">${h.description}</div>
                        </div>
                        <button class="btn btn-danger btn-small" onclick="deleteHoliday(2026, '${h.date}')">Eliminar</button>
                    </div>
                `).join('');
        }
        
        // ==================== CONFIGURACI√ìN ====================
        function exportData() {
            const dataStr = JSON.stringify(state, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `vacapanel_backup_${formatDate(new Date())}.json`;
            a.click();
        }
        
        function importData() {
            const file = document.getElementById('importFile').files[0];
            if (!file) {
                alert('Por favor, selecciona un archivo');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    state = JSON.parse(e.target.result);
                    saveToStorage();
                    renderAll();
                    alert('Datos importados correctamente');
                } catch (error) {
                    alert('Error al importar los datos. El archivo no es v√°lido.');
                }
            };
            reader.readAsText(file);
        }
        
        function resetSystem() {
            if (confirm('¬øEST√ÅS SEGURO? Esto eliminar√° TODOS los datos y no se puede deshacer.')) {
                if (confirm('√öltima confirmaci√≥n: ¬øEliminar todos los datos?')) {
                    localStorage.removeItem('vacapanel_data');
                    state = {
                        employees: [],
                        holidays2025: [],
                        holidays2026: [],
                        vacationRequests: [],
                        activityLog: [],
                        currentYear: 2026
                    };
                    initializeDefaultHolidays();
                    renderAll();
                    alert('Sistema reseteado correctamente');
                }
            }
        }
        
        // ==================== UTILIDADES ====================
        function formatDate(date) {
            if (typeof date === 'string') return date;
            const d = new Date(date);
            const year = d.getFullYear();
            const month = String(d.getMonth() + 1).padStart(2, '0');
            const day = String(d.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }
        
        function formatDateES(dateStr) {
            const [year, month, day] = dateStr.split('-');
            return `${day}/${month}/${year}`;
        }
        
        function renderAll() {
            renderCalendar();
            renderEmployeeList();
            renderRequestList();
            renderActivityLog();
            renderHolidayLists();
            updateEmployeeFilter();
        }
        
        function updateEmployeeFilter() {
            const filter = document.getElementById('employeeFilter');
            const currentValue = filter.value;
            
            filter.innerHTML = '<option value="">Todos los empleados</option>' + 
                state.employees.map(e => `<option value="${e.id}">${e.name}</option>`).join('');
            
            filter.value = currentValue;
        }
        
        function updateYearSelection() {
            const year = parseInt(document.getElementById('requestYear').value);
            const employeeId = parseInt(document.getElementById('requestEmployee').value);
            
            if (!employeeId) return;
            
            const employee = state.employees.find(e => e.id === employeeId);
            const warningDiv = document.getElementById('requestWarning');
            
            if (year === 2025 && employee.days2025Total === 0) {
                warningDiv.innerHTML = '<div class="alert alert-warning">‚ö†Ô∏è Este empleado no tiene d√≠as de 2025 acumulados</div>';
            } else {
                warningDiv.innerHTML = '';
            }
        }
        
        // ==================== INICIO ====================
        window.onload = init;
    </script>
</body>
</html>
